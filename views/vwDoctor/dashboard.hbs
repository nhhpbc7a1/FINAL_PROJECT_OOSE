<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctor Dashboard</title>
  <link rel="stylesheet" href="/public/css/doctor-side/doctor-dashboard.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
</head>
<body>
  <div class="container">
      <div class="content-container">
        <!-- Left Column -->
        <div class="left-column">
          <section class="welcome-section">
            <div class="welcome-text">
              <h1>Hello, Dr. {{doctor.fullName}}</h1>
              <p>Today, you have <span class="highlight-count">{{dashboard.appointments.total}}</span> patients to examine</p>
            </div>
            <div class="welcome-image">
              {{#if doctor.profileImage}}
                <img src="{{doctor.profileImage}}" alt="Doctor" class="doctor-avatar">
              {{else}}
                <img src="/public/images/doctor-profile.svg" alt="Doctor" class="doctor-avatar">
              {{/if}}
            </div>
          </section>
          
          <section class="overview">
            <div class="section-header">
              <h2>Overview</h2>
              <p class="date">{{dashboard.todayFormatted}}</p>
            </div>
            
            <div class="cards">
              <div class="card total-patients">
                <div class="card-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 17V19H2V17C2 17 2 13 9 13C16 13 16 17 16 17ZM12.5 7.5C12.5 9.433 10.933 11 9 11C7.067 11 5.5 9.433 5.5 7.5C5.5 5.567 7.067 4 9 4C10.933 4 12.5 5.567 12.5 7.5ZM15.8 12.5C16.9 13.05 17.75 13.81 18.25 14.69C18.75 15.58 19 16.56 19 17.5V19H22V17.5C22 17.5 22 13.5 15.8 12.5ZM15 4C13.9 4 13 4.9 13 6C13 7.1 13.9 8 15 8C16.1 8 17 7.1 17 6C17 4.9 16.1 4 15 4Z" fill="#006eb9"/>
                  </svg>
                </div>
                <div class="card-content">
                  <div class="card-header">
                    <h3>Total Patients</h3>
                    <span class="card-badge">{{dashboard.totalPatients}}</span>
                  </div>
                  <p class="card-value">{{dashboard.totalPatients}}</p>
                  <div class="card-trend positive">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7 14L12 9L17 14H7Z" fill="currentColor"/>
                    </svg>
                    <span>Total patients registered</span>
                  </div>
                </div>
              </div>
              
              <div class="card examined">
                <div class="card-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z" fill="#28a745"/>
                  </svg>
                </div>
                <div class="card-content">
                  <div class="card-header">
                    <h3>Examined</h3>
                    <span class="card-badge">{{dashboard.appointments.completed}}</span>
                  </div>
                  <p class="card-value">{{dashboard.appointments.completed}}</p>
                  <div class="card-trend positive">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7 14L12 9L17 14H7Z" fill="currentColor"/>
                    </svg>
                    <span>
                      {{#if dashboard.appointments.total}}
                        {{round (multiply (divide dashboard.appointments.completed dashboard.appointments.total) 100)}}% completed
                      {{else}}
                        No appointments today
                      {{/if}}
                    </span>
                  </div>
                </div>
              </div>
              
              <div class="card waiting">
                <div class="card-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13 3C8.03 3 4 7.03 4 12H1L4.89 15.89L4.96 16.03L9 12H6C6 8.13 9.13 5 13 5C16.87 5 20 8.13 20 12C20 15.87 16.87 19 13 19C11.07 19 9.32 18.21 8.06 16.94L6.64 18.36C8.27 19.99 10.51 21 13 21C17.97 21 22 16.97 22 12C22 7.03 17.97 3 13 3ZM12 8V13L16.28 15.54L17 14.33L13.5 12.25V8H12Z" fill="#FF9800"/>
                  </svg>
                </div>
                <div class="card-content">
                  <div class="card-header">
                    <h3>Waiting</h3>
                    <span class="card-badge">{{dashboard.appointments.waiting}}</span>
                  </div>
                  <p class="card-value">{{dashboard.appointments.waiting}}</p>
                  <div class="card-trend positive">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7 14L12 9L17 14H7Z" fill="currentColor"/>
                    </svg>
                    <span>
                      {{#if dashboard.appointments.total}}
                        {{round (multiply (divide dashboard.appointments.waiting dashboard.appointments.total) 100)}}% of today's work
                      {{else}}
                        No waiting appointments
                      {{/if}}
                    </span>
                  </div>
                </div>
              </div>
              
              <div class="card test-results">
                <div class="card-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM14 17H7V15H14V17ZM17 13H7V11H17V13ZM17 9H7V7H17V9Z" fill="#0095ff"/>
                  </svg>
                </div>
                <div class="card-content">
                  <div class="card-header">
                    <h3>Test Results</h3>
                    <span class="card-badge">{{dashboard.pendingTestResults}}</span>
                  </div>
                  <p class="card-value">{{dashboard.pendingTestResults}}</p>
                  <div class="card-trend {{#if dashboard.pendingTestResults}}negative{{else}}positive{{/if}}">
                    {{#if dashboard.pendingTestResults}}
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                    </svg>
                    <span>Should be considered</span>
                    {{else}}
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7 14L12 9L17 14H7Z" fill="currentColor"/>
                    </svg>
                    <span>No pending results</span>
                    {{/if}}
                  </div>
                </div>
              </div>
            </div>
          </section>
            
          <section class="calendar-section">
            <div class="section-header">
              <h2>Appointment Calendar</h2>
              <a href="/doctor/schedule" class="view-all">View Schedule</a>
            </div>
            <div class="calendar-container">
              <div id="calendar"></div>
            </div>
          </section>
        </div>
        
        <!-- Right Column -->
        <div class="right-column">
          <section class="schedule">
            <div class="schedule-header">
              <h2>Today's Schedule</h2>
              <a href="/doctor/appointments" class="view-all">View All</a>
            </div>
            
            <div class="schedule-list">
              {{#if dashboard.todaySchedule.length}}
                {{#each dashboard.todaySchedule}}
                  <div class="schedule-list-item {{statusClass}}">
                    <div class="time-badge">
                      <span>{{timeFormatted}}</span>
                      {{#unless @last}}
                      <div class="time-line"></div>
                      {{/unless}}
                    </div>
                    <div class="appointment-content">
                      <div class="appointment-title">{{reason}}</div>
                      <div class="patient-name">{{patientName}}</div>
                      <div class="room-info">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z" fill="#6c757d"/>
                        </svg>
                        {{specialtyName}} - Room {{roomNumber}}
                      </div>
                      <div class="status-indicator">
                        <span class="status-badge {{patientAppointmentStatus}}">{{patientAppointmentStatus}}</span>
                      </div>
                    </div>
                  </div>
                {{/each}}
              {{else}}
                <div class="no-appointments">
                  <p>No appointments scheduled for today.</p>
                </div>
              {{/if}}
            </div>
          </section>
        </div>
      </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
        locale: 'en',
        initialView: 'dayGridMonth',
        height: 500,
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,listMonth'
        },
        buttonText: {
          today: 'Today',
          month: 'Month',
          week: 'Week',
          list: 'List'
        },
        themeSystem: 'standard',
        events: {{{calendarEvents}}},
        eventTimeFormat: {
          hour: '2-digit',
          minute: '2-digit',
          meridiem: false
        },
        eventDisplay: 'block',
        eventClick: function(info) {
          // Navigate to the appointment details when clicked
          const appointmentId = info.event.id;
          const date = moment(info.event.start).format('YYYY-MM-DD');
          window.location.href = `/doctor/appointments?date=${date}&appointmentId=${appointmentId}`;
        }
      });
      calendar.render();
      
      // Make schedule items clickable to navigate to appointments
      document.querySelectorAll('.schedule-list-item').forEach(item => {
        item.addEventListener('click', function() {
          window.location.href = '/doctor/appointments';
        });
      });
    });
  </script>
</body>
</html>